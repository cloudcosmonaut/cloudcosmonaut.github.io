<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Testing early and often in your software development cycle is a major part of the DevOps philosophy. With GitHub actions, you can run your test on every Pull Request (PR). Testing as early as possible will detect errors in an early stage so errors can be fixed before releasing.
What are GitHub Actions? You might know GitHub as the open source developers platform. GitHub now contains GitHub Actions. You can compare Github Actions with an Azure Devops Pipeline or an AWS CodePipeline."><meta name=keywords content="Hindrik Bruinsma,blog,GitHub,GitHub Actions,DevOps,Azure,Azure DevOps,github actions,devops,swift,pull request,pr,unit test"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://cloudcosmonaut.io/posts/2021/04/run-unit-tests-for-every-pull-request-with-github-actions/><title>Run unit tests for every Pull Request with GitHub Actions :: Cloud Cosmonaut
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Run unit tests for every Pull Request with GitHub Actions"><meta itemprop=description content="Testing early and often in your software development cycle is a major part of the DevOps philosophy. With GitHub actions, you can run your test on every Pull Request (PR). Testing as early as possible will detect errors in an early stage so errors can be fixed before releasing.
What are GitHub Actions? You might know GitHub as the open source developers platform. GitHub now contains GitHub Actions. You can compare Github Actions with an Azure Devops Pipeline or an AWS CodePipeline."><meta itemprop=datePublished content="2021-04-12T09:00:00+02:00"><meta itemprop=dateModified content="2021-04-12T09:00:00+02:00"><meta itemprop=wordCount content="754"><meta itemprop=image content="https://cloudcosmonaut.io/"><meta itemprop=keywords content="github actions,devops,swift,pull request,pr,unit test,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cloudcosmonaut.io/"><meta name=twitter:title content="Run unit tests for every Pull Request with GitHub Actions"><meta name=twitter:description content="Testing early and often in your software development cycle is a major part of the DevOps philosophy. With GitHub actions, you can run your test on every Pull Request (PR). Testing as early as possible will detect errors in an early stage so errors can be fixed before releasing.
What are GitHub Actions? You might know GitHub as the open source developers platform. GitHub now contains GitHub Actions. You can compare Github Actions with an Azure Devops Pipeline or an AWS CodePipeline."><meta property="article:published_time" content="2021-04-12 09:00:00 +0200 +0200"><script async src="https://www.googletagmanager.com/gtag/js?id=G-W4BEF9DFPC"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W4BEF9DFPC",{anonymize_ip:!1})}</script><script defer data-domain=cloudcosmonaut.io src=https://cloudcosmonaut.io/plausible/script.js></script></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>Cloud Cosmonaut</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 minutes</p></div><article><h1 class=post-title><a href=https://cloudcosmonaut.io/posts/2021/04/run-unit-tests-for-every-pull-request-with-github-actions/>Run unit tests for every Pull Request with GitHub Actions</a></h1><div class=post-content><p>Testing early and often in your software development cycle is a major part of the DevOps philosophy. With GitHub actions, you can run your test on every Pull Request (PR). Testing as early as possible will detect errors in an early stage so errors can be fixed before releasing.</p><h2 id=what-are-github-actions>What are GitHub Actions?</h2><p>You might know GitHub as the open source developers platform. GitHub now contains GitHub Actions. You can compare Github Actions with an Azure Devops Pipeline or an AWS CodePipeline. With these Actions you can create a workflow. A workflow is a way of building and deploying your software automatically, often triggered by a PR.</p><p>You define a GitHub Action in a yaml file. In the next section I describe in yaml when and what the Github Action is going to do.</p><h2 id=when-to-trigger>When to trigger</h2><p>To start a GitHub Action you first need to specify when the Action should trigger. The trigger determines when the Action is executed. In this case the Action needs to trigger when a Pull Request is composed against the <code>main</code> branch.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pull_request</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>
</span></span></code></pre></div><h2 id=check-out-the-code>Check out the code</h2><p>Your Action needs to have access to your code, so you need to add a step to checkout your code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span> <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span></code></pre></div><h2 id=run-the-unit-tests>Run the unit tests</h2><p>This step requires you to pass the relative location of the Xcode Project or Workspace file, the scheme
in your project to test and the destination (or target if that&rsquo;s more in your vocabulary)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Xcode Test</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>devbotsxyz/xcode-test@v1.1.0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>project</span>: <span style=color:#e6db74>&#39;project.xsproj&#39;</span> <span style=color:#75715e># `project` and `workspace` cannot be used at the same time</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>workspace</span>: <span style=color:#e6db74>&#39;workspace.xcworkspace&#39;</span> <span style=color:#75715e># `project` and `workspace` cannot be used at the same time</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>scheme</span>: <span style=color:#e6db74>&#39;scheme&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configuration</span>: <span style=color:#ae81ff>Debug</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=latest,name=iPhone 11</span>
</span></span></code></pre></div><h2 id=code-coverage>Code coverage</h2><p>When your code changes over time, you might want to know how your code coverage changes over time. You can do this with Codecov. If you use a private repo, you need to add a Codecov Access Token.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>codecov/codecov-action@v1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Determine code coverage with CodeCov</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># For private repos, an access token for codecov.io is required</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># token: ${{ secrets.CODECOV_TOKEN }}</span>
</span></span></code></pre></div><h2 id=add-testing-matrix>Add testing matrix</h2><p>As I want to know that my library works successfully on different versions of iOS, I want to run my Unit Tests on several SDK versions.</p><p>To do this, you need to change the Test step, in my case <code>Xcode Test</code>, and add a so-called <code>matrix</code>. In my case I only need one dimension in which I put four SDK configurations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>PROJECT_FILE</span>: <span style=color:#75715e># Relative path to Xcode project file</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>SCHEME</span>: <span style=color:#75715e># Name of scheme to test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macos-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matrix</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>xcode</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=latest,name=iPhone 11</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version </span>: <span style=color:#ae81ff>latest-stable</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=14.4,name=iPhone 11</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version</span>: <span style=color:#ae81ff>12.4</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=13.7,name=iPhone 11</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version</span>: <span style=color:#ae81ff>11.7</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=12.4,name=iPhone 7</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version</span>: <span style=color:#ae81ff>10.3</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Xcode Test</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>devbotsxyz/xcode-test@v1.1.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>project</span>: <span style=color:#ae81ff>${{ env.PROJECT_FILE }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>${{ env.PROJECT_SCHEME }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configuration</span>: <span style=color:#ae81ff>Debug</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>${{ matrix.xcode.destination }}</span>
</span></span></code></pre></div><h2 id=result>Result</h2><p>When you completed all steps and committed the GitHub Action as a file in <code>.github/workflows/</code>, you will see the results of the checks when you create a PR.</p><p><img src=/20210413-validation-checks-on-pr.png alt="All checks green!"></p><h3 id=complete-pipeline-yaml>Complete pipeline yaml</h3><p>Here you have the complete pipeline template which I used in one of my projects (<a href=https://github.com/readefries/IBAN-Helper/blob/main/.github/workflows/check-pr.yml>RFIBAN-Helper</a>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Check PR</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pull_request</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>PROJECT_FILE</span>: <span style=color:#75715e># Relative path to Xcode project file</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>SCHEME</span>: <span style=color:#75715e># Name of scheme to test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>macos-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matrix</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>xcode</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=latest,name=iPhone 11</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version </span>: <span style=color:#ae81ff>latest-stable</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=14.4,name=iPhone 11</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version</span>: <span style=color:#ae81ff>12.4</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=13.7,name=iPhone 11</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version</span>: <span style=color:#ae81ff>11.7</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>platform=iOS Simulator,OS=12.4,name=iPhone 7</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>version</span>: <span style=color:#ae81ff>10.3</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>maxim-lobanov/setup-xcode@v1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>xcode-version</span>: <span style=color:#ae81ff>${{ matrix.xcode.version }}</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>ruby/setup-ruby@v1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>bundler-cache</span>: <span style=color:#66d9ef>true</span>      
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Xcode Test</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>devbotsxyz/xcode-test@v1.1.0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>project</span>: <span style=color:#ae81ff>${{ env.PROJECT_FILE }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>${{ env.PROJECT_SCHEME }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configuration</span>: <span style=color:#ae81ff>Debug</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>destination</span>: <span style=color:#ae81ff>${{ matrix.xcode.destination }}</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Perform Cocoapod lib lint validation</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>run</span>: <span style=color:#ae81ff>make validate</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>codecov/codecov-action@v1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Determine code coverage with CodeCov</span>
</span></span></code></pre></div><h2 id=round-up>Round-up</h2><p>You will most likely make mistakes, and that’s okay. <a href="https://www.youtube.com/watch?v=-fIZphLpPiY">Fail forward</a> :) When I started creating GitHub Actions for my projects, it took me a while to get everything up and running. As you added a trigger to run the GitHub Action for every PR, you can try out the settings and steps one by one, because it will run for every push to the branch you created for your PR.</p><p>I hope this helped you move forward with GitHub Actions, please let me know if you run into any trouble.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://cloudcosmonaut.io/tags/github-actions/>github actions</a></span>
<span class=tag><a href=https://cloudcosmonaut.io/tags/devops/>devops</a></span>
<span class=tag><a href=https://cloudcosmonaut.io/tags/swift/>swift</a></span>
<span class=tag><a href=https://cloudcosmonaut.io/tags/pull-request/>pull request</a></span>
<span class=tag><a href=https://cloudcosmonaut.io/tags/pr/>pr</a></span>
<span class=tag><a href=https://cloudcosmonaut.io/tags/unit-test/>unit test</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>754 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-04-12 07:00</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://cloudcosmonaut.io/posts/2021/12/weekly-update-runner-toolchain/><span class=button__icon>←</span>
<span class=button__text>Weekly update runner toolchain</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.0931a358499291afca6f741478e9fc9fa973a9fbd7aeb3390f3b10463966dc8195daf98a0e33685a1fbfb9d7578631c3f31fc8e558eaf6e2c30c4c3e14df4931.js integrity="sha512-CTGjWEmSka/Kb3QUeOn8n6lzqfvXrrM5DzsQRjlm3IGV2vmKDjNoWh+/uddXhjHD8x/I5Vjq9uLDDEw+FN9JMQ=="></script></body></html>