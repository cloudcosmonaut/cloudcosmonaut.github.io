<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Cloud Cosmonaut</title><link>https://cloudcosmonaut.io/posts/</link><description>Recent content in Posts on Cloud Cosmonaut</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Hindrik Bruinsma &lt;a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0&lt;/a></copyright><lastBuildDate>Fri, 27 May 2022 12:00:01 +0200</lastBuildDate><atom:link href="https://cloudcosmonaut.io/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Secure key management for modern developers</title><link>https://cloudcosmonaut.io/posts/2022/secure_keymanagement_for_modern_developers/</link><pubDate>Fri, 27 May 2022 12:00:01 +0200</pubDate><guid>https://cloudcosmonaut.io/posts/2022/secure_keymanagement_for_modern_developers/</guid><description>When we talk about password, most people use a password manager and no longer use the same password for multiple accounts. But I notice, that a lot of people share there SSH key with multiple accounts and don&amp;rsquo;t even protect them with a passphrase.
What do we need? Similar to keys to your house keys, you want seperate keys for the different persona&amp;rsquo;s you imporsonate or roles you have. E.g. for your home projects, your work projects, and client projects.</description><content type="html"><![CDATA[<p>When we talk about password, most people use a password manager and no longer use the same password for multiple accounts. But I notice, that a lot of people share there SSH key with multiple accounts and don&rsquo;t even protect them with a passphrase.</p>
<h1 id="what-do-we-need">What do we need?</h1>
<p>Similar to keys to your house keys, you want seperate keys for the different persona&rsquo;s you imporsonate or roles you have. E.g. for your home projects, your work projects, and client projects. But also per Saas or PaaS you connect to (e.g. GitHub, Azure DevOps, etc.).</p>
<p>You want this in two forms. Keys to connect to the remote systems, and keys to sign your commits. Commit signing will be story for another time ;) It&rsquo;s a good security practice, to add passwords to your keys. Please don&rsquo;t forget this. Services like GitHub and Azure DevOps can enforce this with a policy, but don&rsquo;t do this by default.</p>
<h1 id="setting-up-ssh-keys-for-secure-connection">Setting up SSH-keys for secure connection</h1>
<p>Note, you should create keys according to the current standards. Currently, you should use a Elyptic curve based key. One downside, Azure DevOps doesn&rsquo;t support these modern keys and rely on a legacy RSA key.</p>
<p>Generating a key for my work role @Xpirit on GitHub:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -t ed25519 -C <span style="color:#e6db74">&#34;xpirit@github&#34;</span> -f ~/.ssh/id_ed25519_xpirit_github
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -t rsa -b <span style="color:#ae81ff">4096</span> -C <span style="color:#e6db74">&#34;customer@azdo&#34;</span> -f ~/.ssh/id_rsa_customer_azdo
</span></span></code></pre></div><p>GitHub stores the keys on your account level, you can only assign specific keys to an organization when SSO is enabled for this organization.</p>
<p>You can add your ssh key <a href="https://github.com/settings/keys">https://github.com/settings/keys</a>.</p>
<p>On Azure DevOps, keys are spicificly bound to your account on an organization. So this gives you a little better fine grained control. You can only assign a key to a single organization. Azure DevOps will prevent you from re-using a key.</p>
<p>Just go the the accouns settings of your user on the organization, like:
<a href="https://dev.azure.com/%3C%3CORGANIZATION%3E%3E/_usersSettings/keys">https://dev.azure.com/&laquo;ORGANIZATION&raquo;/_usersSettings/keys</a>.</p>
]]></content></item><item><title>Weekly update runner toolchain</title><link>https://cloudcosmonaut.io/posts/2021/12/weekly-update-runner-toolchain/</link><pubDate>Thu, 30 Dec 2021 09:00:01 +0200</pubDate><guid>https://cloudcosmonaut.io/posts/2021/12/weekly-update-runner-toolchain/</guid><description>When using GitHub Enterprise Server in a large organization, you might run into problems due to limited or no internet connection. Or you might have set-up your runners to be detroyed everytime a workflow is triggered. In either case, you can speed up the workflow by using cached versions of tools the workflow need. Node, go, python, etc. These tools are setup with actions/node-setup@v2 or similar step.
The general idea is that you run actions/node-setup@v2 with every version you need and then create a tarball of the runnner.</description><content type="html"><![CDATA[<p>When using GitHub Enterprise Server in a large organization, you might run into problems due to limited or no internet connection. Or you might have set-up your runners to be detroyed everytime a workflow is triggered. In either case, you can speed up the workflow by using cached versions of tools the workflow need. Node, go, python, etc. These tools are setup with <a href="https://github.com/actions/setup-node">actions/node-setup@v2</a> or similar step.</p>
<p>The general idea is that you run <code>actions/node-setup@v2</code> with every version you need and then create a tarball of the <code>runnner.tool_cache</code> folder.</p>
<p>You can install these cached toolchains in the <code>RUNNER_DIR/_work/_tool</code> folder grouped by tool. Just extract the toolchain to the <code>RUNNER_DIR/_work/_tool</code> folder and it will be automatically installed. e.g. <code>tar -xzf node_tool_cache.tar.gz -C RUNNER_DIR/_work/_tool/node</code>.</p>
<p>I created some example workfslows for Node, Go and Python which might be useful for you.
<a href="https://github.com/cloudcosmonaut/runner-toolchains">cloudcosmonaut/runner-toolchains</a></p>
]]></content></item><item><title>Run unit tests for every Pull Request with GitHub Actions</title><link>https://cloudcosmonaut.io/posts/2021/04/run-unit-tests-for-every-pull-request-with-github-actions/</link><pubDate>Mon, 12 Apr 2021 09:00:00 +0200</pubDate><guid>https://cloudcosmonaut.io/posts/2021/04/run-unit-tests-for-every-pull-request-with-github-actions/</guid><description>Testing early and often in your software development cycle is a major part of the DevOps philosophy. With GitHub actions, you can run your test on every Pull Request (PR). Testing as early as possible will detect errors in an early stage so errors can be fixed before releasing.
What are GitHub Actions? You might know GitHub as the open source developers platform. GitHub now contains GitHub Actions. You can compare Github Actions with an Azure Devops Pipeline or an AWS CodePipeline.</description><content type="html"><![CDATA[<p>Testing early and often in your software development cycle is a major part of the DevOps philosophy. With GitHub actions, you can run your test on every Pull Request (PR). Testing as early as possible will detect errors in an early stage so errors can be fixed before releasing.</p>
<h2 id="what-are-github-actions">What are GitHub Actions?</h2>
<p>You might know GitHub as the open source developers platform. GitHub now contains GitHub Actions. You can compare Github Actions with an Azure Devops Pipeline or an AWS CodePipeline. With these Actions you can create a workflow. A workflow is a way of building and deploying your software automatically, often triggered by a PR.</p>
<p>You define a GitHub Action in a yaml file. In the next section I describe in yaml when and what the Github Action is going to do.</p>
<h2 id="when-to-trigger">When to trigger</h2>
<p>To start a GitHub Action you first need to specify when the Action should trigger. The trigger determines when the Action is executed. In this case the Action needs to trigger when a Pull Request is composed against the <code>main</code> branch.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#ae81ff">main ]</span>
</span></span></code></pre></div><h2 id="check-out-the-code">Check out the code</h2>
<p>Your Action needs to have access to your code, so you need to add a step to checkout your code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span> <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
</span></span></code></pre></div><h2 id="run-the-unit-tests">Run the unit tests</h2>
<p>This step requires you to pass the relative location of the Xcode Project or Workspace file, the scheme
in your project to test and the destination (or target if that&rsquo;s more in your vocabulary)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Xcode Test</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">devbotsxyz/xcode-test@v1.1.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">project</span>: <span style="color:#e6db74">&#39;project.xsproj&#39;</span> <span style="color:#75715e"># `project` and `workspace` cannot be used at the same time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">workspace</span>: <span style="color:#e6db74">&#39;workspace.xcworkspace&#39;</span> <span style="color:#75715e"># `project` and `workspace` cannot be used at the same time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#e6db74">&#39;scheme&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configuration</span>: <span style="color:#ae81ff">Debug</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=latest,name=iPhone 11</span>
</span></span></code></pre></div><h2 id="code-coverage">Code coverage</h2>
<p>When your code changes over time, you might want to know how your code coverage changes over time. You can do this with Codecov. If you use a private repo, you need to add a Codecov Access Token.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">codecov/codecov-action@v1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Determine code coverage with CodeCov</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># For private repos, an access token for codecov.io is required</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># token: ${{ secrets.CODECOV_TOKEN }}</span>
</span></span></code></pre></div><h2 id="add-testing-matrix">Add testing matrix</h2>
<p>As I want to know that my library works successfully on different versions of iOS, I want to run my Unit Tests on several SDK versions.</p>
<p>To do this, you need to change the Test step, in my case <code>Xcode Test</code>, and add a so-called <code>matrix</code>. In my case I only need one dimension in which I put four SDK configurations.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">PROJECT_FILE</span>: <span style="color:#75715e"># Relative path to Xcode project file</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">SCHEME</span>: <span style="color:#75715e"># Name of scheme to test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">macos-latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">matrix</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xcode</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=latest,name=iPhone 11</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version </span>: <span style="color:#ae81ff">latest-stable</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=14.4,name=iPhone 11</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version</span>: <span style="color:#ae81ff">12.4</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=13.7,name=iPhone 11</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version</span>: <span style="color:#ae81ff">11.7</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=12.4,name=iPhone 7</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version</span>: <span style="color:#ae81ff">10.3</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Xcode Test</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">devbotsxyz/xcode-test@v1.1.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">project</span>: <span style="color:#ae81ff">${{ env.PROJECT_FILE }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">${{ env.PROJECT_SCHEME }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configuration</span>: <span style="color:#ae81ff">Debug</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">${{ matrix.xcode.destination }}</span>
</span></span></code></pre></div><h2 id="result">Result</h2>
<p>When you completed all steps and committed the GitHub Action as a file in <code>.github/workflows/</code>, you will see the results of the checks when you create a PR.</p>
<p><img src="/20210413-validation-checks-on-pr.png" alt="All checks green!"></p>
<h3 id="complete-pipeline-yaml">Complete pipeline yaml</h3>
<p>Here you have the complete pipeline template which I used in one of my projects (<a href="https://github.com/readefries/IBAN-Helper/blob/main/.github/workflows/check-pr.yml">RFIBAN-Helper</a>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check PR</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#ae81ff">main ]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">PROJECT_FILE</span>: <span style="color:#75715e"># Relative path to Xcode project file</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">SCHEME</span>: <span style="color:#75715e"># Name of scheme to test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">macos-latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">matrix</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xcode</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=latest,name=iPhone 11</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version </span>: <span style="color:#ae81ff">latest-stable</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=14.4,name=iPhone 11</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version</span>: <span style="color:#ae81ff">12.4</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=13.7,name=iPhone 11</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version</span>: <span style="color:#ae81ff">11.7</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">platform=iOS Simulator,OS=12.4,name=iPhone 7</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">version</span>: <span style="color:#ae81ff">10.3</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">maxim-lobanov/setup-xcode@v1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xcode-version</span>: <span style="color:#ae81ff">${{ matrix.xcode.version }}</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">ruby/setup-ruby@v1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">bundler-cache</span>: <span style="color:#66d9ef">true</span>      
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Xcode Test</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">devbotsxyz/xcode-test@v1.1.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">project</span>: <span style="color:#ae81ff">${{ env.PROJECT_FILE }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">${{ env.PROJECT_SCHEME }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configuration</span>: <span style="color:#ae81ff">Debug</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">${{ matrix.xcode.destination }}</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Perform Cocoapod lib lint validation</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">make validate</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">codecov/codecov-action@v1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Determine code coverage with CodeCov</span>
</span></span></code></pre></div><h2 id="round-up">Round-up</h2>
<p>You will most likely make mistakes, and that’s okay. <a href="https://www.youtube.com/watch?v=-fIZphLpPiY">Fail forward</a> :) When I started creating GitHub Actions for my projects, it took me a while to get everything up and running. As you added a trigger to run the GitHub Action for every PR, you can try out the settings and steps one by one, because it will run for every push to the branch you created for your PR.</p>
<p>I hope this helped you move forward with GitHub Actions, please let me know if you run into any trouble.</p>
]]></content></item></channel></rss>